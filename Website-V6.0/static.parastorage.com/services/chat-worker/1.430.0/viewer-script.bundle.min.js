!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["viewer-script"]=t():e["viewer-script"]=t()}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="https://static.parastorage.com/services/chat-worker/1.430.0/",n(n.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageDirectionServer=void 0,function(e){e.CustomerToBusiness="CUSTOMER_TO_BUSINESS",e.BusinessToCustomer="BUSINESS_TO_CUSTOMER"}(t.MessageDirectionServer||(t.MessageDirectionServer={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transformMessage=void 0;var r=n(0);t.transformMessage=function(e,t){var n=e.data&&e.data[0]&&e.data[0].data.text||void 0,o=e.metadata||void 0,i=t===r.MessageDirectionServer.CustomerToBusiness?"VisitorToBusiness":"BusinessToVisitor",a=n?"TEXT":void 0,s=e.summary,u=e.chatroomId,c=e.sender.userId,d={};o&&(d=Object.keys(o).reduce((function(e,t){try{e[t]=JSON.parse(o[t])}catch(n){e[t]=o[t]}return e}),{}));var f={text:n},l=e.createdAt?new Date(e.createdAt):void 0,p={role:"user"===e.sender.type?"Admin":"Visitor",id:e.sender.userId};return{channelId:u,sequence:e.sequence,type:a,summary:s,participantId:c,createdDate:l,metadata:d,payload:f,direction:i,sender:p}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transformChatroom=void 0;var r=n(1),o=n(0);t.transformChatroom=function(e){var t=e.id,n=e.lastMessage,i=e.name,a=e.initials,s=e.businessContext,u=e.thumbnail||"";return{id:t,displayData:s?{image:u,name:i,initials:a}:{image:u,name:i},messages:[r.transformMessage(n,o.MessageDirectionServer.CustomerToBusiness)]}}},function(e,t,n){var r=n(7);e.exports={createControllers:r.createControllers,initAppForPage:r.initAppForPage,exports:r.chatApi}},function(e,t,n){var r=n(5),o=n(6);e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[i+s]=a[s];return t||o(a)}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,o=n;return[o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]]].join("")}},function(e,t,n){"use strict";n.r(t),n.d(t,"chatApi",(function(){return y})),n.d(t,"createControllers",(function(){return S})),n.d(t,"initAppForPage",(function(){return M}));var r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function i(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var a,s=n(1),u=n(4),c={},d=function(e,t,n){c.pubSub.subscribe(e,(function(e){var r=e.data;return t(Object(s.transformMessage)(r,n))}))},f=function(e,t,n){c.pubSub.subscribe(e,(function(e){return t(n,e)}))},l=function(e,t,n){return v(e,t).then((function(e){return e?e[n]:null}))},p=new Promise((function(e){a=e})),v=function(e,t){var n=u(),a=e+"Response."+n;return new Promise((function(s,u){return o(void 0,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:return[4,p];case 1:return o.sent(),c.pubSub.subscribe(a,(function(e){var t=e.data,n=void 0===t?{success:!1,results:{}}:t,r=n.success,o=n.results;c.pubSub.unsubscribe(a),r?s(o):u()})),c.pubSub.publish(e,r({requestId:String(n)},t),!1),[2]}}))}))}))},h=n(2),g=n(0),b=function(e,t){var n=e.type,r=void 0===n?"":n,o=e.channelId,i=""===r&&""===(void 0===o?"":o),a=["Business","Focused",""].includes(r);if(i||!a)throw new Error(t+" expect to get valid type (Business / Focused) or channelId")},m={onMessage:function(e){d("ChatWidget.onMessageReceived",e,g.MessageDirectionServer.BusinessToCustomer),d("ChatWidget.onMessageSent",e,g.MessageDirectionServer.CustomerToBusiness)},isMembersChatEnabled:function(){return l("ChatWidget.getChatSettings",{},"isSocialChat")},isBusinessChatEnabled:function(){return l("ChatWidget.getChatSettings",{},"isBusinessChat")},isWidgetAvailable:function(){return l("ChatWidget.getChatState",{},"isWidgetAvailable")},startPrivateChat:function(e){return v("ChatWidget.startPrivateChat",{userId:e})}},y=r(r({},{onMessageReceived:function(e){d("ChatWidget.onMessageReceived",e,g.MessageDirectionServer.BusinessToCustomer)},onMessageSent:function(e){d("ChatWidget.onMessageSent",e,g.MessageDirectionServer.CustomerToBusiness)},onMinimize:function(e){return f("ChatWidget.onWidgetCollapsed",e,"Collapsed")},onMaximize:function(e){return f("ChatWidget.onWidgetExpand",e,"Expand")},sendMessage:function(e){var t=e.messageText,n=e.channelId;return v("ChatWidget.sendMessage",{message:t,chatroom:void 0===n?null:n})},maximize:function(){return v("ChatWidget.expandWidget",{})},minimize:function(){return v("ChatWidget.collapseWidget",{})},focusChannel:function(e){var t=void 0===e?{}:e,n=t.channelId,r=void 0===n?"":n,a=t.type,s=void 0===a?"":a;return o(void 0,void 0,void 0,(function(){return i(this,(function(e){return b({type:s,channelId:r},"focusChannel"),[2,v("ChatWidget.focusChannel",{type:s,channelId:r})]}))}))},getChannelList:function(){return o(void 0,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,l("ChatWidget.getChatState",{},"chatrooms")];case 1:return e=t.sent(),[2,e.map((function(e){return Object(h.transformChatroom)(e._chatroom)}))]}}))}))},maximized:function(){return l("ChatWidget.getChatState",{},"isWidgetExpanded")},getChannel:function(e){var t=void 0===e?{}:e,n=t.type,r=void 0===n?"":n,a=t.channelId,s=void 0===a?"":a;return o(void 0,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return b({type:r,channelId:s},"getChannel"),[4,v("ChatWidget.getChannel",{type:r,channelId:s})];case 1:return e=t.sent(),[2,Object(h.transformChatroom)(e.channel)]}}))}))},startChannel:function(e){var t=void 0===e?{}:e,n=t.type,r=void 0===n?"":n,o=t.userId;return l("ChatWidget.startChannel",{type:r,userId:void 0===o?"":o},"channelId")}}),m),C=function(e){},S=function(e){return e.map((function(){return Promise.resolve({pageReady:C,exports:function(){return y}})}))},M=function(e,t){return function(e,t){e.instance;var n=t.pubSub;return c.pubSub=n,n.subscribe("ChatWidget.isReady",(function(){return a()}),!0),Promise.resolve()}({instance:e.instance},{pubSub:t.pubSub})}}])}));
//# sourceMappingURL=viewer-script.bundle.min.js.map